%% 测试相关矩阵的性质
%% 相关信号的COV

t=(1:400)';
fs=16000;
f=6000;
theta=0.9;
theta=(0:5)*theta;
t2=bsxfun(@plus,t,theta);
wav_all=sin(2*pi*f/fs*t2)*10;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
[r,i]=max(R(1,1,:)); %i=33
Rf=R(:,:,i);
N=rand(6,6)*0.0001;
N=rand(6,6)*0;
[V,D]=eig(Rf+N);     % D  70000     7000000（（幅度大10倍，能量大100倍） 
% 
% 

% 
% V =
% 
%   -0.1081 + 0.0185i  -0.3408 + 0.0255i  -0.6927 - 0.2798i  -0.2325 - 0.2702i   0.1155 + 0.0776i   0.4063 - 0.0400i
%   -0.0736 + 0.0009i  -0.6082 + 0.0778i   0.1706 + 0.2258i   0.5386 + 0.1789i  -0.2178 - 0.0488i   0.4070 - 0.0320i
%   -0.1331 + 0.0008i   0.0848 + 0.0145i   0.3120 - 0.0352i  -0.5762 + 0.0584i  -0.6072 + 0.0748i   0.4075 - 0.0240i
%   -0.1299 + 0.0095i   0.6927 - 0.0642i  -0.3049 + 0.0831i   0.4434 + 0.0143i  -0.1864 - 0.0302i   0.4079 - 0.0160i
%   -0.4283 + 0.0082i   0.1025 - 0.0064i   0.3824 + 0.0460i  -0.1218 + 0.0175i   0.6888 - 0.0378i   0.4082 - 0.0080i
%    0.8743             0.0728             0.1226            -0.0597             0.2122             0.4082          
% 
% D
% 
% D =
% 
%   1.0e+006 *
% 
%    -0.0000         0         0         0         0         0
%          0   -0.0000         0         0         0         0
%          0         0    0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    6.9984
% 
% angle(V)
% 
% ans =
% 
%     2.9722    3.0669   -2.7577   -2.2814    0.5916   -0.0982
%     3.1297    3.0143    0.9239    0.3207   -2.9212   -0.0785
%     3.1358    0.1696   -0.1123    3.0406    3.0190   -0.0589
%     3.0687   -0.0925    2.8754    0.0321   -2.9810   -0.0393
%     3.1225   -0.0619    0.1197    2.9990   -0.0548   -0.0196
%          0         0         0    3.1416         0         0
% 
% av=angle(V);
% av(2:end,:)-av(1:end-1,:)
% 
% ans =
% 
%     0.1575   -0.0526    3.6816    2.6021   -3.5128    0.0196
%     0.0061   -2.8448   -1.0362    2.7200    5.9402    0.0196
%    -0.0671   -0.2620    2.9877   -3.0085   -5.9999    0.0196
%     0.0538    0.0306   -2.7558    2.9668    2.9261    0.0196
%    -3.1225    0.0619   -0.1197    0.1426    0.0548    0.0196
     
%% 不相关噪声的COV  angle没有规律，eigen小

t=(1:400)';
fs=16000;
f=6000;
theta=0.9;
theta=(0:5)*theta;
wav_all=rand(400,6)*10;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
i=33;
Rf=R(:,:,i);
N=rand(6,6)*0;
[V,D]=eig(Rf+N);   %V 的幅度与角度没有关系  Eigen 最大值变小  96    6357（幅度大10倍，能量大100倍）

% 
% D =
% 
%   1.0e+004 *
% 
%    -0.0000         0         0         0         0         0
%          0    0.0000         0         0         0         0
%          0         0    0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    1.0963
% 
% V
% 
% V =
% 
%   -0.0415 + 0.1362i   0.0503 - 0.0775i   0.2657 + 0.6437i  -0.1873 + 0.0879i  -0.0506 - 0.1613i   0.1891 - 0.6157i
%   -0.2704 + 0.5649i  -0.2940 + 0.7171i   0.0098 - 0.0733i  -0.0037 + 0.0067i  -0.0091 + 0.0013i   0.0139 - 0.0368i
%   -0.7261 - 0.2299i   0.5979 + 0.1458i   0.0672 - 0.0600i  -0.0577 - 0.0008i  -0.0871 - 0.0122i  -0.1469 - 0.0224i
%   -0.0237 - 0.0180i  -0.0466 - 0.0539i  -0.6318 - 0.2153i   0.2352 + 0.2863i  -0.0675 - 0.0985i  -0.2568 - 0.5753i
%    0.0756 - 0.0007i  -0.0632 - 0.0080i  -0.1493 - 0.0531i  -0.4343 - 0.0879i  -0.8664 - 0.1028i  -0.0047 + 0.0868i
%   -0.0293             0.0549             0.1755             0.7875            -0.4338             0.3962          
% 
% av=angle(V)
% 
% av =
% 
%     1.8668   -0.9950    1.1793    2.7026   -1.8746   -1.2728
%     2.0172    1.9599   -1.4380    2.0835    2.9982   -1.2106
%    -2.8349    0.2391   -0.7287   -3.1276   -3.0020   -2.9903
%    -2.4920   -2.2834   -2.8132    0.8830   -2.1718   -1.9907
%    -0.0088   -3.0161   -2.7997   -2.9419   -3.0235    1.6250
%     3.1416         0         0         0    3.1416         0
% 
% av(2:end,:)-av(1:end-1,:)
% 
% ans =
% 
%     0.1504    2.9549   -2.6173   -0.6191    4.8728    0.0622
%    -4.8521   -1.7208    0.7094   -5.2111   -6.0002   -1.7797
%     0.3429   -2.5225   -2.0845    4.0106    0.8302    0.9996
%     2.4832   -0.7327    0.0135   -3.8249   -0.8518    3.6157
%     3.1504    3.0161    2.7997    2.9419    6.1651   -1.6250
%% +noise

t=(1:400)';
fs=16000;
f=6000;
theta=0.9;
theta=(0:5)*theta;
t2=bsxfun(@plus,t,theta);
wav_all=sin(2*pi*f/fs*t2)*10+rand(400,6)*10;
%wav_all=sin(2*pi*f/fs*t2)*10+rand(400,6)*1;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
[r,i]=max(R(1,1,:)); %i=33
Rf=R(:,:,i);
N=rand(6,6)*0.0001;
N=rand(6,6)*0;
[V,D]=eig(Rf+N);     % D  70000     7000000（（幅度大10倍，能量大100倍） 
D
V
av=angle(V)
vsub= av(2:end,:)-av(1:end-1,:)
disp 相位调回0－PI
vsub+(vsub<0)*pi*2

%%    
%wav_all=sin(2*pi*f/fs*t2)*10+rand(400,6)*10;   %噪声较大时  eigen变小一点， 相位噪声变大
%D =
% 
%   1.0e+006 *
% 
%    -0.0000         0         0         0         0         0
%          0   -0.0000         0         0         0         0
%          0         0   -0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    7.2375
% 
% 
% V =
% 
%   -0.0082 + 0.0280i   0.0172 - 0.3060i  -0.0452 + 0.0513i   0.7347 + 0.1019i   0.4442 - 0.0130i  -0.1431 + 0.3640i
%    0.2593 + 0.1438i   0.1204 - 0.0540i   0.3208 + 0.4242i   0.2535 - 0.3969i  -0.1839 + 0.4270i  -0.2483 - 0.3348i
%    0.0443 + 0.1012i  -0.5982 - 0.3184i  -0.1377 + 0.1105i  -0.1397 + 0.1136i   0.1671 + 0.5171i   0.4084 - 0.0536i
%   -0.0087 + 0.1380i   0.0043 - 0.0449i  -0.0064 + 0.7684i  -0.3865 + 0.1168i   0.1223 - 0.2195i  -0.1603 + 0.3694i
%    0.1726 + 0.5982i  -0.0990 - 0.4413i   0.0698 - 0.2087i  -0.1220 + 0.0946i   0.0806 - 0.3920i  -0.2268 - 0.3521i
%    0.7016             0.4721            -0.2057            -0.0938             0.2602             0.4075          
% 
% 
% av =
% 
%     1.8565   -1.5146    2.2931    0.1379   -0.0292    1.9455
%     0.5063   -0.4213    0.9234   -1.0024    1.9775   -2.2089
%     1.1583   -2.6524    2.4656    2.4590    1.2582   -0.1305
%     1.6334   -1.4760    1.5791    2.8481   -1.0625    1.9801
%     1.2899   -1.7915   -1.2481    2.4821   -1.3680   -2.1430
%          0         0    3.1416    3.1416         0         0
% 
% 
% vsub =
% 
%    -1.3502    1.0933   -1.3697   -1.1402    2.0067   -4.1544
%     0.6520   -2.2312    1.5422    3.4614   -0.7193    2.0785
%     0.4751    1.1765   -0.8865    0.3890   -2.3207    2.1106
%    -0.3435   -0.3155   -2.8272   -0.3660   -0.3056   -4.1231
%    -1.2899    1.7915    4.3897    0.6595    1.3680    2.1430
% 
% 相位调回0－PI
% ans =
% 
%     4.9330    1.0933    4.9135    5.1430    2.0067    2.1288
%     0.6520    4.0520    1.5422    3.4614    5.5639    2.0785
%     0.4751    1.1765    5.3967    0.3890    3.9625    2.1106
%     5.9397    5.9677    3.4560    5.9172    5.9776    2.1601
%     4.9933    1.7915    4.3897    0.6595    1.3680    2.1430




%wav_all=sin(2*pi*f/fs*t2)*10+rand(400,6)*1;   %噪声较小时  eigen不变， 相位噪声变小
% 
% D =
% 
%   1.0e+006 *
% 
%    -0.0000         0         0         0         0         0
%          0   -0.0000         0         0         0         0
%          0         0   -0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    7.0127
% 
% 
% V =
% 
%    0.0779 + 0.2112i  -0.2769 - 0.3930i   0.0193 + 0.1215i   0.1691 - 0.1994i   0.2434 - 0.6398i  -0.1560 + 0.3765i
%    0.1901 - 0.0089i  -0.4791 + 0.0105i  -0.0397 + 0.1439i   0.4139 + 0.5928i  -0.1488 - 0.0206i  -0.2400 - 0.3301i
%   -0.1071 - 0.0772i  -0.2240 - 0.1152i   0.6875 - 0.3527i   0.2016 + 0.0738i   0.3098 + 0.1127i   0.4077 - 0.0323i
%    0.1888 - 0.2177i  -0.2712 - 0.4302i  -0.2535 - 0.4425i  -0.0314 - 0.0542i  -0.1363 + 0.4571i  -0.1861 + 0.3635i
%    0.3614 + 0.3037i  -0.3492 + 0.0375i   0.1800 + 0.1942i  -0.3169 - 0.4206i   0.2278 + 0.2965i  -0.2142 - 0.3473i
%    0.7680             0.3063            -0.1881             0.2855             0.1810             0.4083          
% 
% 
% av =
% 
%     1.2176   -2.1845    1.4131   -0.8675   -1.2072    1.9636
%    -0.0470    3.1197    1.8401    0.9612   -3.0041   -2.1994
%    -2.5166   -2.6665   -0.4740    0.3509    0.3489   -0.0790
%    -0.8562   -2.1332   -2.0912   -2.0962    1.8605    2.0439
%     0.6989    3.0346    0.8232   -2.2164    0.9157   -2.1234
%          0         0    3.1416         0         0         0
% 
% 
% ans =
% 
%    -1.2646    5.3042    0.4269    1.8287   -1.7969   -4.1630
%    -2.4695   -5.7862   -2.3141   -0.6103    3.3530    2.1203
%     1.6604    0.5333   -1.6172   -2.4471    1.5116    2.1230
%     1.5552    5.1677    2.9143   -0.1203   -0.9448   -4.1674
%    -0.6989   -3.0346    2.3184    2.2164   -0.9157    2.1234

% 相位调回0－PI
% ans =
% 
%     1.3983    4.5488    4.3880    0.0573    1.5205    2.1251
%     1.7548    2.9380    4.3956    0.0971    2.3416    2.1155
%     0.3455    2.4633    4.6044    0.7914    2.6943    2.1258
%     1.4119    4.4066    4.2331    5.7133    2.5602    2.1181
%     6.2224    6.1524    5.3152    2.7160    4.5304    2.1177
%% 两个同频率，不同方向信号    无法分开

t=(1:400)';
fs=16000;
f=6000;
theta=0.9;
theta=(0:5)*theta;
theta2=-0.9;
theta2=(0:5)*theta2;
t2=bsxfun(@plus,t,theta);
t3=bsxfun(@plus,t,theta2);
wav_all=sin(2*pi*f/fs*t2)*10+sin(2*pi*f/fs*t3)*1+rand(400,6)*0;
%wav_all=sin(2*pi*f/fs*t2)*10+rand(400,6)*1;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
[r,i]=max(R(1,1,:)); %i=33
Rf=R(:,:,i);
N=rand(6,6)*0.0001;
N=rand(6,6)*0;
[V,D]=eig(Rf+N);     % D  70000     7000000（（幅度大10倍，能量大100倍） 
D
V
av=angle(V)
vsub= av(2:end,:)-av(1:end-1,:)
disp 相位调回0－PI
vsub+(vsub<0)*pi*2
% 
% D =
% 
%   1.0e+006 *
% 
%    -0.0000         0         0         0         0         0
%          0   -0.0000         0         0         0         0
%          0         0    0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    7.0520
% 
% 
% V =
% 
%    0.1212 - 0.2731i  -0.2784 + 0.7022i   0.2462 - 0.2402i   0.0956 + 0.0731i   0.0809 + 0.0273i  -0.2021 + 0.3991i
%    0.1021 + 0.2265i   0.2805 + 0.3310i  -0.0223 + 0.2299i   0.2387 + 0.6813i  -0.1179 - 0.0982i  -0.1729 - 0.3495i
%   -0.1377 + 0.1190i  -0.0310 - 0.2138i   0.7160 - 0.2953i   0.1192 + 0.2460i   0.1538 - 0.2727i   0.3827 - 0.0339i
%    0.0086 - 0.1519i   0.0416 - 0.4226i  -0.2732 - 0.3646i  -0.1258 + 0.5792i   0.1528 + 0.1207i  -0.2271 + 0.3849i
%   -0.1940 + 0.0270i   0.0109 + 0.0768i  -0.0485 - 0.1093i   0.1630 - 0.0833i   0.8016 + 0.3293i  -0.1454 - 0.3684i
%    0.8685             0.0905            -0.0817            -0.0694             0.2869             0.3790          
% 
% 
% av =
% 
%    -1.1530    1.9483   -0.7731    0.6529    0.3259    2.0394
%     1.1472    0.8677    1.6674    1.2338   -2.4472   -2.0301
%     2.4290   -1.7148   -0.3912    1.1196   -1.0573   -0.0883
%    -1.5146   -1.4727   -2.2139    1.7847    0.6687    2.1037
%     3.0031    1.4295   -1.9881   -0.4723    0.3898   -1.9468
%          0         0   -3.1416    3.1416         0         0
% 
% 
% vsub =
% 
%     2.3002   -1.0805    2.4405    0.5809   -2.7730   -4.0695
%     1.2817   -2.5826   -2.0587   -0.1142    1.3898    1.9418
%    -3.9435    0.2422   -1.8227    0.6651    1.7260    2.1921
%     4.5177    2.9022    0.2258   -2.2570   -0.2789   -4.0505
%    -3.0031   -1.4295   -1.1535    3.6139   -0.3898    1.9468
% 
% 相位调回0－PI
% 
% ans =
% 
%     2.3002    5.2026    2.4405    0.5809    3.5102    2.2136
%     1.2817    3.7006    4.2245    6.1690    1.3898    1.9418
%     2.3397    0.2422    4.4605    0.6651    1.7260    2.1921
%     4.5177    2.9022    0.2258    4.0262    6.0043    2.2326
%     3.2800    4.8537    5.1297    3.6139    5.8934    1.9468
%% noise

t=(1:400)';
fs=16000;
f=1000;
d=0:5;
theta1=0.1*d;
theta2=0.13*d;
t2=bsxfun(@plus,t,theta1);
wav_all1=sin(2*pi*f/fs*t2)*0;
wav_all2=(rand(400,6)-0.5)*512;
wav_all=wav_all1+wav_all2;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
[r,i]=max(R(1,1,:)); %i=33
Rf=R(:,:,i);
N=rand(6,6)*0.0001;
[V,D]=eig(Rf+N);     %
D
av(2:6,1)-av(1:5,1)

% 方向向量可视化 
for i=1:256
    fftn=zeros(512,1);
    fftn(i)=ffts(1,1,i);
    fftn(512+1-i)=ffts(1,1,i); 
    w(:,i)=ifft(fftn);
    plot(real(w(:,i)));
    pause(0.25);
end



%% 不同角度   角度变小，eigen向量的相位差也变小
0.9 2.12
0.45 1.06
0.2 0.47
-0.2 0.47
t=(1:400)';
fs=16000;
f=6000;
theta=0.9;
theta=(0:5)*theta;
t2=bsxfun(@plus,t,theta);
wav_all=sin(2*pi*f/fs*t2)*10;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
[r,i]=max(R(1,1,:)); %i=33
Rf=R(:,:,i);
N=rand(6,6)*0.0001;
N=rand(6,6)*0;
[V,D]=eig(Rf+N);     % D  70000     7000000（（幅度大10倍，能量大100倍） 
D
V
av=angle(V)
vsub= av(2:end,:)-av(1:end-1,:)
disp 相位调回0－PI
vsub+(vsub<0)*pi*2
%  
% D =
% 
%   1.0e+006 *
% 
%    -0.0000         0         0         0         0         0
%          0   -0.0000         0         0         0         0
%          0         0    0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    6.9984
% 
% 
% V =
% 
%    0.0339 + 0.0521i  -0.2896 - 0.7705i   0.2159 - 0.2010i   0.1651 + 0.1658i   0.0808 - 0.0613i  -0.1562 + 0.3772i
%    0.0324 - 0.0111i  -0.0525 + 0.0741i  -0.3728 - 0.5534i   0.0056 + 0.5741i   0.1460 + 0.1667i  -0.2400 - 0.3303i
%   -0.1064 - 0.2819i   0.2266 + 0.0728i   0.3130 - 0.0472i   0.6179 + 0.3662i  -0.2591 + 0.0516i   0.4070 - 0.0320i
%   -0.1241 + 0.5076i   0.2183 + 0.3929i   0.2587 - 0.4230i   0.1367 - 0.0495i   0.0502 - 0.2978i  -0.1853 + 0.3638i
%    0.6999 + 0.3233i  -0.1796 + 0.0780i   0.2929 + 0.1720i   0.2769 + 0.0027i  -0.0670 + 0.0638i  -0.2133 - 0.3481i
%    0.1916             0.1316             0.0798             0.0436             0.8781             0.4082          
% 
% 
% av =
% 
%     0.9939   -1.9303   -0.7496    0.7876   -0.6487    1.9635
%    -0.3316    2.1875   -2.1636    1.5611    0.8514   -2.1991
%    -1.9318    0.3109   -0.1497    0.5350    2.9451   -0.0785
%     1.8106    1.0637   -1.0219   -0.3474   -1.4037    2.0420
%     0.4328    2.7318    0.5311    0.0098    2.3802   -2.1206
%          0         0         0         0         0         0
% 
% 
% vsub =
% 
%    -1.3255    4.1178   -1.4140    0.7734    1.5001   -4.1626
%    -1.6001   -1.8766    2.0139   -1.0261    2.0937    2.1206
%     3.7423    0.7528   -0.8722   -0.8824   -4.3489    2.1206
%    -1.3778    1.6681    1.5530    0.3572    3.7839   -4.1626
%    -0.4328   -2.7318   -0.5311   -0.0098   -2.3802    2.1206
% 
% 相位调回0－PI
% 
% ans =
% 
%     4.9577    4.1178    4.8692    0.7734    1.5001    2.1206
%     4.6830    4.4066    2.0139    5.2571    2.0937    2.1206
%     3.7423    0.7528    5.4110    5.4008    1.9343    2.1206
%     4.9054    1.6681    1.5530    0.3572    3.7839    2.1206
%     5.8504    3.5514    5.7521    6.2733    3.9030    2.1206
 
 
 
t=(1:400)';
fs=16000;
f=6000;
theta=0.45;
theta=(0:5)*theta;
t2=bsxfun(@plus,t,theta);
wav_all=sin(2*pi*f/fs*t2)*10;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
[r,i]=max(R(1,1,:)); %i=33
Rf=R(:,:,i);
N=rand(6,6)*0.0001;
N=rand(6,6)*0;
[V,D]=eig(Rf+N);     % D  70000     7000000（（幅度大10倍，能量大100倍） 
D
V
av=angle(V)
vsub= av(2:end,:)-av(1:end-1,:)
disp 相位调回0－PI
vsub+(vsub<0)*pi*2
%  
%  
% D =
% 
%   1.0e+006 *
% 
%    -0.0000         0         0         0         0         0
%          0    0.0000         0         0         0         0
%          0         0    0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    6.9984
% 
% 
% V =
% 
%    0.3264 + 0.0885i  -0.1053 + 0.4065i  -0.5420 - 0.2452i  -0.2888 + 0.1502i   0.1964 + 0.2103i   0.2268 + 0.3394i
%   -0.0647 + 0.1488i   0.0384 - 0.2630i  -0.4992 + 0.1578i   0.6244 - 0.2486i   0.0092 + 0.1020i  -0.1853 + 0.3638i
%    0.0131 - 0.2561i  -0.1690 - 0.4957i  -0.3428 + 0.2473i  -0.5344 + 0.1614i  -0.0502 - 0.0222i  -0.4079 + 0.0160i
%   -0.2140 - 0.4864i  -0.4186 + 0.4553i  -0.2324 - 0.0119i   0.1402 - 0.3054i  -0.0009 + 0.0377i  -0.2133 - 0.3481i
%   -0.4046 + 0.5281i  -0.2866 - 0.1139i  -0.2775 - 0.0408i  -0.0626 + 0.0731i   0.3023 - 0.3410i   0.1995 - 0.3562i
%   -0.2618             0.0331            -0.2460            -0.0924            -0.8335             0.4082          
% 
% 
% av =
% 
%     0.2647    1.8242   -2.7168    2.6621    0.8196    0.9817
%     1.9811   -1.4258    2.8354   -0.3790    1.4813    2.0420
%    -1.5199   -1.8994    2.5167    2.8484   -2.7242    3.1023
%    -1.9852    2.3142   -3.0906   -1.1404    1.5933   -2.1206
%     2.2245   -2.7634   -2.9958    2.2788   -0.8454   -1.0603
%    -3.1416         0    3.1416    3.1416    3.1416         0
% 
% 
% vsub =
% 
%     1.7164   -3.2501    5.5522   -3.0410    0.6617    1.0603
%    -3.5009   -0.4735   -0.3187    3.2273   -4.2055    1.0603
%    -0.4654    4.2136   -5.6073   -3.9888    4.3176   -5.2229
%     4.2097   -5.0775    0.0948    3.4193   -2.4388    1.0603
%    -5.3661    2.7634    6.1374    0.8628    3.9870    1.0603
% 
% 相位调回0－PI
% 
% ans =
% 
%     1.7164    3.0331    5.5522    3.2422    0.6617    1.0603
%     2.7823    5.8096    5.9645    3.2273    2.0777    1.0603
%     5.8178    4.2136    0.6759    2.2944    4.3176    1.0603
%     4.2097    1.2057    0.0948    3.4193    3.8444    1.0603
%     0.9171    2.7634    6.1374    0.8628    3.9870    1.0603


 
t=(1:400)';
fs=16000;
f=6000;
theta=0.2;
theta=(0:5)*theta;
t2=bsxfun(@plus,t,theta);
wav_all=sin(2*pi*f/fs*t2)*10;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
[r,i]=max(R(1,1,:)); %i=33
Rf=R(:,:,i);
N=rand(6,6)*0.0001;
N=rand(6,6)*0;
[V,D]=eig(Rf+N);     % D  70000     7000000（（幅度大10倍，能量大100倍） 
D
V
av=angle(V)
vsub= av(2:end,:)-av(1:end-1,:)
disp 相位调回0－PI
vsub+(vsub<0)*pi*2
 
%  
% D =
% 
%   1.0e+006 *
% 
%    -0.0000         0         0         0         0         0
%          0   -0.0000         0         0         0         0
%          0         0    0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    6.9984
% 
% 
% V =
% 
%    0.0215 - 0.0645i   0.3528 + 0.4891i  -0.4384 - 0.3345i   0.0002 + 0.3551i   0.1438 + 0.1191i  -0.2887 - 0.2887i
%   -0.0703 + 0.0549i  -0.2323 + 0.0502i  -0.4067 + 0.2431i   0.0134 - 0.6504i   0.0477 + 0.3448i  -0.1262 - 0.3883i
%    0.2213 + 0.2202i   0.6353 - 0.2944i   0.3448 - 0.1795i  -0.1303 - 0.2492i  -0.0249 + 0.1219i   0.0639 - 0.4032i
%    0.2937 - 0.3810i   0.0069 - 0.0828i  -0.0279 + 0.5298i  -0.0877 + 0.4178i  -0.2401 + 0.2714i   0.2400 - 0.3303i
%   -0.7127 + 0.0896i   0.0726 - 0.2676i  -0.1898 + 0.0226i  -0.3338 + 0.2040i   0.2249 - 0.0203i   0.3638 - 0.1853i
%    0.3778            -0.0761            -0.0478             0.1906             0.8039             0.4082          
% 
% 
% av =
% 
%    -1.2489    0.9460   -2.4897    1.5703    0.6919   -2.3562
%     2.4786    2.9287    2.6027   -1.5501    1.4333   -1.8850
%     0.7829   -0.4339   -0.4800   -2.0525    1.7722   -1.4137
%    -0.9141   -1.4877    1.6234    1.7777    2.2951   -0.9425
%     3.0165   -1.3059    3.0229    2.5931   -0.0902   -0.4712
%          0    3.1416    3.1416         0         0         0
% 
% 
% vsub =
% 
%     3.7275    1.9827    5.0925   -3.1204    0.7414    0.4712
%    -1.6957   -3.3625   -3.0827   -0.5024    0.3389    0.4712
%    -1.6970   -1.0538    2.1034    3.8302    0.5230    0.4712
%     3.9306    0.1818    1.3996    0.8154   -2.3853    0.4712
%    -3.0165    4.4475    0.1187   -2.5931    0.0902    0.4712
% 
% 相位调回0－PI
% 
% ans =
% 
%     3.7275    1.9827    5.0925    3.1628    0.7414    0.4712
%     4.5875    2.9207    3.2004    5.7808    0.3389    0.4712
%     4.5862    5.2294    2.1034    3.8302    0.5230    0.4712
%     3.9306    0.1818    1.3996    0.8154    3.8978    0.4712
%     3.2667    4.4475    0.1187    3.6901    0.0902    0.4712

t=(1:400)';
fs=16000;
f=6000;
theta=-0.2;
theta=(0:5)*theta;
t2=bsxfun(@plus,t,theta);
wav_all=sin(2*pi*f/fs*t2)*10;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
[r,i]=max(R(1,1,:)); %i=33
Rf=R(:,:,i);
N=rand(6,6)*0.0001;
N=rand(6,6)*0;
[V,D]=eig(Rf+N);     % D  70000     7000000（（幅度大10倍，能量大100倍） 
D
V
av=angle(V)
vsub= av(2:end,:)-av(1:end-1,:)
disp 相位调回0－PI
vsub+(vsub<0)*pi*2
 
%  
% D =
% 
%   1.0e+006 *
% 
%    -0.0000         0         0         0         0         0
%          0   -0.0000         0         0         0         0
%          0         0    0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    6.9984
% 
% 
% V =
% 
%   -0.4226 + 0.2848i  -0.4913 - 0.1515i   0.1523 - 0.2701i   0.3248 - 0.3009i   0.1065 + 0.0759i  -0.2887 + 0.2887i
%    0.3125 + 0.0635i   0.5143 - 0.4995i   0.0325 - 0.2091i  -0.0621 - 0.3571i  -0.1541 + 0.1334i  -0.1262 + 0.3883i
%   -0.2489 - 0.3128i   0.0029 + 0.3111i   0.3654 + 0.3878i  -0.2311 - 0.1933i  -0.2581 + 0.3681i   0.0639 + 0.4032i
%   -0.1212 - 0.1858i   0.1649 + 0.1686i  -0.5128 - 0.1726i   0.5203 + 0.2445i  -0.0564 + 0.3194i   0.2400 + 0.3303i
%   -0.3780 - 0.1549i   0.1218 - 0.0854i   0.0532 - 0.1190i   0.0249 - 0.0696i  -0.2895 - 0.7335i   0.3638 + 0.1853i
%    0.5126            -0.2171             0.5152             0.4958            -0.1104             0.4082          
% 
% 
% av =
% 
%     2.5486   -2.8424   -1.0572   -0.7472    0.6194    2.3562
%     0.2005   -0.7708   -1.4165   -1.7429    2.4278    1.8850
%    -2.2429    1.5616    0.8151   -2.4451    2.1822    1.4137
%    -2.1489    0.7964   -2.8169    0.4392    1.7455    0.9425
%    -2.7528   -0.6116   -1.1503   -1.2271   -1.9468    0.4712
%          0    3.1416         0         0    3.1416         0
% 
% 
% vsub =
% 
%    -2.3481    2.0716   -0.3593   -0.9957    1.8084   -0.4712
%    -2.4434    2.3324    2.2316   -0.7022   -0.2456   -0.4712
%     0.0940   -0.7652   -3.6320    2.8843   -0.4368   -0.4712
%    -0.6039   -1.4080    1.6666   -1.6664   -3.6922   -0.4712
%     2.7528    3.7532    1.1503    1.2271    5.0884   -0.4712
% 
% 相位调回0－PI
% 
% ans =
% 
%     3.9351    2.0716    5.9239    5.2875    1.8084    5.8119
%     3.8398    2.3324    2.2316    5.5810    6.0376    5.8119
%     0.0940    5.5180    2.6512    2.8843    5.8464    5.8119
%     5.6793    4.8752    1.6666    4.6168    2.5910    5.8119
%     2.7528    3.7532    1.1503    1.2271    5.0884    5.8119


%%
%% 不同频率   角度变小，eigen向量的相位差也变小    角度/频率不变
6000 2.12
3000 1.0603
t=(1:400)';
fs=16000;
f=6000;
theta=0.9;
theta=(0:5)*theta;
t2=bsxfun(@plus,t,theta);
wav_all=sin(2*pi*f/fs*t2)*10;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
[r,i]=max(R(1,1,:)); %i=33
Rf=R(:,:,i);
N=rand(6,6)*0.0001;
N=rand(6,6)*0;
[V,D]=eig(Rf+N);     % D  70000     7000000（（幅度大10倍，能量大100倍） 
D
V
av=angle(V)
vsub= av(2:end,:)-av(1:end-1,:)
disp 相位调回0－PI
vsub+(vsub<0)*pi*2
 
%  
%  
% D =
% 
%   1.0e+006 *
% 
%    -0.0000         0         0         0         0         0
%          0   -0.0000         0         0         0         0
%          0         0    0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    6.9984
% 
% 
% V =
% 
%    0.0339 + 0.0521i  -0.2896 - 0.7705i   0.2159 - 0.2010i   0.1651 + 0.1658i   0.0808 - 0.0613i  -0.1562 + 0.3772i
%    0.0324 - 0.0111i  -0.0525 + 0.0741i  -0.3728 - 0.5534i   0.0056 + 0.5741i   0.1460 + 0.1667i  -0.2400 - 0.3303i
%   -0.1064 - 0.2819i   0.2266 + 0.0728i   0.3130 - 0.0472i   0.6179 + 0.3662i  -0.2591 + 0.0516i   0.4070 - 0.0320i
%   -0.1241 + 0.5076i   0.2183 + 0.3929i   0.2587 - 0.4230i   0.1367 - 0.0495i   0.0502 - 0.2978i  -0.1853 + 0.3638i
%    0.6999 + 0.3233i  -0.1796 + 0.0780i   0.2929 + 0.1720i   0.2769 + 0.0027i  -0.0670 + 0.0638i  -0.2133 - 0.3481i
%    0.1916             0.1316             0.0798             0.0436             0.8781             0.4082          
% 
% 
% av =
% 
%     0.9939   -1.9303   -0.7496    0.7876   -0.6487    1.9635
%    -0.3316    2.1875   -2.1636    1.5611    0.8514   -2.1991
%    -1.9318    0.3109   -0.1497    0.5350    2.9451   -0.0785
%     1.8106    1.0637   -1.0219   -0.3474   -1.4037    2.0420
%     0.4328    2.7318    0.5311    0.0098    2.3802   -2.1206
%          0         0         0         0         0         0
% 
% 
% vsub =
% 
%    -1.3255    4.1178   -1.4140    0.7734    1.5001   -4.1626
%    -1.6001   -1.8766    2.0139   -1.0261    2.0937    2.1206
%     3.7423    0.7528   -0.8722   -0.8824   -4.3489    2.1206
%    -1.3778    1.6681    1.5530    0.3572    3.7839   -4.1626
%    -0.4328   -2.7318   -0.5311   -0.0098   -2.3802    2.1206
% 
% 相位调回0－PI
% 
% ans =
% 
%     4.9577    4.1178    4.8692    0.7734    1.5001    2.1206
%     4.6830    4.4066    2.0139    5.2571    2.0937    2.1206
%     3.7423    0.7528    5.4110    5.4008    1.9343    2.1206
%     4.9054    1.6681    1.5530    0.3572    3.7839    2.1206
%     5.8504    3.5514    5.7521    6.2733    3.9030    2.1206



t=(1:400)';
fs=16000;
f=3000;
theta=0.9;
theta=(0:5)*theta;
t2=bsxfun(@plus,t,theta);
wav_all=sin(2*pi*f/fs*t2)*10;
[frames,ffts]=multi_fft(wav_all,400, 400,512);
outer=outProdND(ffts); %M*M*T*F
R=squeeze(outer);
[r,i]=max(R(1,1,:)); %i=33
Rf=R(:,:,i);
N=rand(6,6)*0.0001;
N=rand(6,6)*0;
[V,D]=eig(Rf+N);     % D  70000     7000000（（幅度大10倍，能量大100倍） 
D
V
av=angle(V)
vsub= av(2:end,:)-av(1:end-1,:)
disp 相位调回0－PI
vsub+(vsub<0)*pi*2
 
% 
% D =
% 
%   1.0e+006 *
% 
%    -0.0000         0         0         0         0         0
%          0   -0.0000         0         0         0         0
%          0         0   -0.0000         0         0         0
%          0         0         0    0.0000         0         0
%          0         0         0         0    0.0000         0
%          0         0         0         0         0    6.9984
% 
% 
% V =
% 
%   -0.1127 - 0.0970i   0.0614 - 0.2162i  -0.1366 - 0.1636i  -0.0774 - 0.6093i  -0.5089 - 0.2813i   0.2268 + 0.3394i
%   -0.0391 - 0.0024i   0.2933 - 0.4499i  -0.1395 + 0.1818i   0.3513 + 0.1329i  -0.1536 + 0.5711i  -0.1853 + 0.3638i
%    0.0995 - 0.0850i   0.3509 + 0.1038i   0.4225 + 0.0964i  -0.4196 - 0.4751i   0.1701 + 0.2524i  -0.4079 + 0.0160i
%    0.0563 + 0.0352i  -0.0779 - 0.1356i  -0.3313 - 0.7258i   0.1037 - 0.2448i   0.1502 + 0.2733i  -0.2133 - 0.3481i
%   -0.4156 + 0.3606i   0.5409 - 0.2675i  -0.1445 + 0.1591i  -0.0193 - 0.0882i   0.2637 - 0.2065i   0.1995 - 0.3562i
%    0.8075             0.3723            -0.1775            -0.0321             0.1006             0.4082          
% 
% 
% av =
% 
%    -2.4305   -1.2942   -2.2667   -1.6971   -2.6367    0.9817
%    -3.0797   -0.9930    2.2254    0.3617    1.8335    2.0420
%    -0.7072    0.2875    0.2243   -2.2943    0.9778    3.1023
%     0.5584   -2.0921   -1.9991   -1.1702    1.0682   -2.1206
%     2.4269   -0.4592    2.3079   -1.7865   -0.6644   -1.0603
%          0         0    3.1416    3.1416         0         0
% 
% 
% vsub =
% 
%    -0.6492    0.3012    4.4921    2.0588    4.4701    1.0603
%     2.3725    1.2805   -2.0011   -2.6560   -0.8556    1.0603
%     1.2656   -2.3796   -2.2234    1.1241    0.0904   -5.2229
%     1.8685    1.6329    4.3070   -0.6163   -1.7326    1.0603
%    -2.4269    0.4592    0.8337    4.9281    0.6644    1.0603
% 
% 相位调回0－PI
% 
% ans =
% 
%     5.6340    0.3012    4.4921    2.0588    4.4701    1.0603
%     2.3725    1.2805    4.2821    3.6272    5.4276    1.0603
%     1.2656    3.9036    4.0598    1.1241    0.0904    1.0603
%     1.8685    1.6329    4.3070    5.6669    4.5506    1.0603
%     3.8563    0.4592    0.8337    4.9281    0.6644    1.0603